require "pathname"

log_level       :info
log_location    STDOUT
node_name       "chef-knife"
client_key      (Pathname.new(Dir.home) + ".chef/knife.pem").to_s
chef_server_url <%= @chef_server_url.dump %>
cache_type      "BasicFile"
cache_options   path: (Pathname.new(Dir.home) + ".chef/checksums").to_s

begin
  require "librarian/chef"
  require "librarian/spec_change_set"

  env = Librarian::Chef::Environment.new

  raise ArgumentError, "#{env.specfile_name} and #{env.lockfile_name} are out of sync" \
    if !Librarian::SpecChangeSet.new(env, env.spec, env.lock).same?

  # Initialize the plugin if execution reaches this point.
  require "librarian/chef/integration/knife"

  cookbook_path Librarian::Chef.install_path.to_s
rescue StandardError
  # Failure to set up the plugin means that we fall back to a lame default.
  cookbook_path "cookbooks"
end
